<!DOCTYPE html>
<script type="module">
    import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";
    const studentenData = {
        "theologie": {
            "naam": "Faculteit Theologie en Religiewetenschappen",
            "vlaams": {
                "N-VA": 1,
                "Vlaams Belang": 1,
                "CD&V": 6,
                "PVDA": 1
            },
            "federaal": {
                "N-VA": 1,
                "CD&V": 6,
                "Groen": 1,
                "PVDA": 1
            },
            "europees": {
                "N-VA": 1,
                "CD&V": 3,
                "Groen": 3,
                "Ik weet het nog niet": 2
            }
        },
        "kerkelijk-recht": {
            "naam": "Bijzondere Faculteit Kerkelijk Recht",
            "vlaams": {
                "Vlaams Belang": 2,
                "CD&V": 1
            },
            "federaal": {
                "N-VA": 1,
                "Vlaams Belang": 2
            },
            "europees": {
                "Vlaams Belang": 2,
                "CD&V": 1
            }
        },
        "hiw": {
            "naam": "Hoger Instituut voor Wijsbegeerte",
            "vlaams": {
                "N-VA": 1,
                "Vlaams Belang": 3,
                "Open VLD": 1,
                "CD&V": 1,
                "Vooruit": 3,
                "Groen": 3,
                "PVDA": 7,
                "Ik stem blanco": 1
            },
            "federaal": {
                "N-VA": 1,
                "Vlaams Belang": 3,
                "Open VLD": 1,
                "CD&V": 1,
                "Vooruit": 4,
                "Groen": 4,
                "PVDA": 5,
                "Ik stem blanco": 1,
                "Ik weet het nog niet": 2
            },
            "europees": {
                "Vlaams Belang": 3,
                "Open VLD": 1,
                "CD&V": 1,
                "Vooruit": 2,
                "Groen": 5,
                "PVDA": 4,
                "Ik stem blanco": 1,
                "Volt": 3,
                "Ik weet het nog niet": 2
            }
        },
        "rechten-crimin": {
            "naam": "Faculteit Rechtsgeleerdheid en Criminologische Wetenschappen",
            "vlaams": {
                "N-VA": 74,
                "Vlaams Belang": 39,
                "Open VLD": 59,
                "CD&V": 51,
                "Vooruit": 63,
                "Groen": 57,
                "PVDA": 23,
                "Ik stem blanco": 2,
                "Niet van plan te gaan stemmen": 4,
                "Voor U": 3,
                "Ik weet het nog niet": 41
            },
            "federaal": {
                "N-VA": 87,
                "Vlaams Belang": 30,
                "Open VLD": 71,
                "CD&V": 50,
                "Vooruit": 55,
                "Groen": 55,
                "PVDA": 18,
                "Ik stem blanco": 2,
                "Niet van plan te gaan stemmen": 4,
                "Voor U": 2,
                "L'Unie": 1
            },
            "europees": {
                "N-VA": 59,
                "Vlaams Belang": 33,
                "Open VLD": 76,
                "CD&V": 46,
                "Vooruit": 39,
                "Groen": 70,
                "PVDA": 14,
                "Ik stem blanco": 3,
                "Niet van plan te gaan stemmen": 3,
                "Ik stem blanco": 1,
                "Voor U": 3,
                "Volt": 6,
                "Ik weet het nog niet": 63
            }
        },
        "econ": {
            "naam": "Faculteit Economie en Bedrijfswetenschappen",
            "vlaams": {
                "N-VA": 21,
                "Vlaams Belang": 10,
                "Open VLD": 5,
                "CD&V": 6,
                "Vooruit": 3,
                "Groen": 4,
                "PVDA": 1,
                "Voor U": 1,
                "Ik weet het nog niet": 8
            },
            "federaal": {
                "N-VA": 27,
                "Vlaams Belang": 8,
                "Open VLD": 4,
                "CD&V": 2,
                "Vooruit": 3,
                "Groen": 4,
                "PVDA": 1,
                "Voor U": 1,
                "Ik weet het nog niet": 9
            },
            "europees": {
                "N-VA": 12,
                "Vlaams Belang": 9,
                "Open VLD": 9,
                "CD&V": 5,
                "Vooruit": 3,
                "Groen": 6,
                "PVDA": 1,
                "Voor U": 1,
                "Volt": 3,
                "Ik weet het nog niet": 10
            }
        },
        "soc": {
            "naam": "Faculteit Sociale Wetenschappen",
            "vlaams": {
                "N-VA": 10,
                "Vlaams Belang": 9,
                "Open VLD": 13,
                "CD&V": 10,
                "Vooruit": 26,
                "Groen": 21,
                "PVDA": 14,
                "Ik stem blanco": 2,
                "Niet van plan te gaan stemmen": 1,
                "Partij Blanco": 1,
                "Ik weet het nog niet": 9
            },
            "federaal": {
                "N-VA": 13,
                "Vlaams Belang": 7,
                "Open VLD": 10,
                "CD&V": 12,
                "Vooruit": 28,
                "Groen": 19,
                "PVDA": 13,
                "Ik stem blanco": 2,
                "Niet van plan te gaan stemmen": 1,
                "L'Unie": 2,
                "Ik weet het nog niet": 9
            },
            "europees": {
                "N-VA": 8,
                "Vlaams Belang": 7,
                "Open VLD": 16,
                "CD&V": 8,
                "Vooruit": 22,
                "Groen": 25,
                "PVDA": 7,
                "Ik stem blanco": 1,
                "Niet van plan te gaan stemmen": 1,
                "Ik stem blanco": 1,
                "Volt": 6,
                "Ik weet het nog niet": 14
            }
        },
        "letteren": {
            "naam": "Faculteit Letteren",
            "vlaams": {
                "N-VA": 49,
                "Vlaams Belang": 20,
                "Open VLD": 21,
                "CD&V": 48,
                "Vooruit": 86,
                "Groen": 116,
                "PVDA": 64,
                "Ik stem blanco": 3,
                "Niet van plan te gaan stemmen": 2,
                "Partij Blanco": 2,
                "Ik weet het nog niet": 61
            },
            "federaal": {
                "N-VA": 50,
                "Vlaams Belang": 17,
                "Open VLD": 25,
                "CD&V": 41,
                "Vooruit": 73,
                "Groen": 109,
                "PVDA": 63,
                "Ik stem blanco": 2,
                "Niet van plan te gaan stemmen": 2,
                "Partij Blanco": 6,
                "Voor U": 1,
                "L'Unie": 10,
                "Ik weet het nog niet": 73
            },
            "europees": {
                "N-VA": 40,
                "Vlaams Belang": 19,
                "Open VLD": 29,
                "CD&V": 29,
                "Vooruit": 57,
                "Groen": 126,
                "PVDA": 48,
                "Ik stem blanco": 3,
                "Niet van plan te gaan stemmen": 2,
                "Ik stem blanco": 3,
                "Partij Blanco": 3,
                "Volt": 25,
                "Ik weet het nog niet": 88
            }
        },
        "ppw": {
            "naam": "Faculteit Psychologische en Pedagogische Wetenschappen",
            "vlaams": {
                "N-VA": 6,
                "Vlaams Belang": 1,
                "Open VLD": 4,
                "CD&V": 7,
                "Vooruit": 11,
                "Groen": 19,
                "PVDA": 10,
                "Voor U": 1,
                "Ik weet het nog niet": 6
            },
            "federaal": {
                "N-VA": 6,
                "Vlaams Belang": 1,
                "Open VLD": 4,
                "CD&V": 5,
                "Vooruit": 10,
                "Groen": 15,
                "PVDA": 9,
                "Voor U": 1,
                "Ik weet het nog niet": 14
            },
            "europees": {
                "N-VA": 5,
                "Vlaams Belang": 1,
                "Open VLD": 3,
                "CD&V": 6,
                "Vooruit": 6,
                "Groen": 22,
                "PVDA": 3,
                "Ik stem blanco": 1,
                "Volt": 1,
                "Ik weet het nog niet": 17
            }
        },
        "wet": {
            "naam": "Faculteit Wetenschappen",
            "vlaams": {
                "N-VA": 65,
                "Vlaams Belang": 24,
                "Open VLD": 22,
                "CD&V": 25,
                "Vooruit": 88,
                "Groen": 83,
                "PVDA": 32,
                "Ik stem blanco": 3,
                "Niet van plan te gaan stemmen": 4,
                "Voor U": 5,
                "Ik weet het nog niet": 51
            },
            "federaal": {
                "N-VA": 60,
                "Vlaams Belang": 22,
                "Open VLD": 28,
                "CD&V": 35,
                "Vooruit": 81,
                "Groen": 81,
                "PVDA": 28,
                "Ik stem blanco": 3,
                "Niet van plan te gaan stemmen": 3,
                "Voor U": 3,
                "L'Unie": 3,
                "Ik weet het nog niet": 55
            },
            "europees": {
                "N-VA": 43,
                "Vlaams Belang": 21,
                "Open VLD": 39,
                "CD&V": 29,
                "Vooruit": 55,
                "Groen": 77,
                "PVDA": 23,
                "Ik stem blanco": 5,
                "Niet van plan te gaan stemmen": 3,
                "Voor U": 1,
                "Volt": 28,
                "Ik weet het nog niet": 78
            }
        },
        "ing": {
            "naam": "Faculteit Ingenieurswetenschappen",
            "vlaams": {
                "N-VA": 77,
                "Vlaams Belang": 29,
                "Open VLD": 33,
                "CD&V": 25,
                "Vooruit": 32,
                "Groen": 18,
                "PVDA": 11,
                "Ik stem blanco": 3,
                "Niet van plan te gaan stemmen": 3,
                "Partij Blanco": 2,
                "Voor U": 4,
                "Ik weet het nog niet": 20
            },
            "federaal": {
                "N-VA": 84,
                "Vlaams Belang": 18,
                "Open VLD": 31,
                "CD&V": 25,
                "Vooruit": 33,
                "Groen": 18,
                "PVDA": 9,
                "Ik stem blanco": 3,
                "Niet van plan te gaan stemmen": 4,
                "Partij Blanco": 3,
                "Voor U": 4,
                "Ik weet het nog niet": 25
            },
            "europees": {
                "N-VA": 61,
                "Vlaams Belang": 25,
                "Open VLD": 33,
                "CD&V": 19,
                "Vooruit": 28,
                "Groen": 24,
                "PVDA": 7,
                "Ik stem blanco": 3,
                "Niet van plan te gaan stemmen": 4,
                "Partij Blanco": 3,
                "Voor U": 2,
                "Volt": 9,
                "Ik weet het nog niet": 39
            }
        },
        "bio": {
            "naam": "Faculteit Bio-ingenieurswetenschappen",
            "vlaams": {
                "N-VA": 7,
                "Open VLD": 3,
                "CD&V": 5,
                "Vooruit": 11,
                "Groen": 16,
                "PVDA": 1,
                "Partij Blanco": 1,
                "Ik weet het nog niet": 9
            },
            "federaal": {
                "N-VA": 8,
                "Open VLD": 3,
                "CD&V": 4,
                "Vooruit": 10,
                "Groen": 16,
                "PVDA": 1,
                "Partij Blanco": 1,
                "Ik weet het nog niet": 10
            },
            "europees": {
                "N-VA": 6,
                "Open VLD": 6,
                "CD&V": 4,
                "Vooruit": 8,
                "Groen": 14,
                "PVDA": 1,
                "Partij Blanco": 1,
                "Volt": 2,
                "Ik weet het nog niet": 11
            }
        },
        "iiw": {
            "naam": "Faculteit Industriële Ingenieurswetenschappen",
            "vlaams": {
                "N-VA": 7,
                "Vlaams Belang": 6,
                "Open VLD": 4,
                "CD&V": 2,
                "Vooruit": 4,
                "Groen": 2,
                "PVDA": 1,
                "Niet van plan te gaan stemmen": 1,
                "Ik weet het nog niet": 4
            },
            "federaal": {
                "N-VA": 5,
                "Vlaams Belang": 6,
                "Open VLD": 5,
                "CD&V": 2,
                "Vooruit": 3,
                "Groen": 1,
                "PVDA": 1,
                "Ik weet het nog niet": 8
            },
            "europees": {
                "N-VA": 6,
                "Vlaams Belang": 6,
                "Open VLD": 5,
                "CD&V": 1,
                "Vooruit": 2,
                "Groen": 2,
                "PVDA": 1,
                "Ik stem blanco": 1,
                "Ik weet het nog niet": 7
            }
        },
        "arch": {
            "naam": "Faculteit Architectuur",
            "vlaams": {
                "N-VA": 1,
                "Vlaams Belang": 1,
                "Vooruit": 4,
                "Groen": 2,
                "Ik weet het nog niet": 2
            },
            "federaal": {
                "N-VA": 2,
                "Open VLD": 1,
                "Vooruit": 3,
                "Groen": 1,
                "PVDA": 1,
                "Ik weet het nog niet": 2
            },
            "europees": {
                "N-VA": 1,
                "Open VLD": 2,
                "Vooruit": 2,
                "Groen": 1,
                "PVDA": 1,
                "Ik weet het nog niet": 3
            }
        },
        "geneesk": {
            "naam": "Faculteit Geneeskunde",
            "vlaams": {
                "N-VA": 18,
                "Vlaams Belang": 4,
                "Open VLD": 9,
                "CD&V": 9,
                "Vooruit": 19,
                "Groen": 22,
                "PVDA": 16,
                "Niet van plan te gaan stemmen": 2,
                "Voor U": 1,
                "Ik weet het nog niet": 19
            },
            "federaal": {
                "N-VA": 19,
                "Vlaams Belang": 3,
                "Open VLD": 8,
                "CD&V": 5,
                "Vooruit": 18,
                "Groen": 18,
                "PVDA": 15,
                "Niet van plan te gaan stemmen": 2,
                "Voor U": 2,
                "L'Unie": 1,
                "Ik weet het nog niet": 28
            },
            "europees": {
                "N-VA": 12,
                "Vlaams Belang": 6,
                "Open VLD": 10,
                "CD&V": 9,
                "Vooruit": 15,
                "Groen": 19,
                "PVDA": 13,
                "Ik stem blanco": 1,
                "Niet van plan te gaan stemmen": 2,
                "Ik stem blanco": 1,
                "Voor U": 2,
                "Volt": 3,
                "Ik weet het nog niet": 26
            }
        },
        "farma": {
            "naam": "Faculteit Farmaceutische Wetenschappen",
            "vlaams": {
                "N-VA": 2,
                "Vlaams Belang": 1,
                "Open VLD": 2,
                "CD&V": 1,
                "Vooruit": 1,
                "Groen": 1
            },
            "federaal": {
                "N-VA": 1,
                "Vlaams Belang": 1,
                "Open VLD": 3,
                "CD&V": 1,
                "Vooruit": 1,
                "PVDA": 1
            },
            "europees": {
                "N-VA": 1,
                "Vlaams Belang": 1,
                "Open VLD": 3,
                "CD&V": 1,
                "Vooruit": 1,
                "Ik weet het nog niet": 1
            }
        },
        "brw": {
            "naam": "Faculteit Bewegings- en Revalidatiewetenschappen",
            "vlaams": {
                "N-VA": 10,
                "Vlaams Belang": 3,
                "Open VLD": 4,
                "CD&V": 6,
                "Vooruit": 5,
                "Groen": 6,
                "PVDA": 3,
                "Niet van plan te gaan stemmen": 1,
                "Voor U": 1,
                "Ik weet het nog niet": 7
            },
            "federaal": {
                "N-VA": 9,
                "Vlaams Belang": 3,
                "Open VLD": 5,
                "CD&V": 5,
                "Vooruit": 4,
                "Groen": 8,
                "Voor U": 1,
                "Ik weet het nog niet": 11
            },
            "europees": {
                "N-VA": 10,
                "Vlaams Belang": 2,
                "Open VLD": 7,
                "CD&V": 4,
                "Vooruit": 5,
                "Groen": 7,
                "Ik weet het nog niet": 11
            }
        }
    }

    const proffenData = {
        "proffen": {
            "naam": "Professoren en ZAP",
            "vlaams": {
                "N-VA": 20,
                "Vlaams Belang": 3,
                "Open VLD": 7,
                "CD&V": 23,
                "Vooruit": 22,
                "Groen": 47,
                "PVDA": 9,
                "Blanco": 1,
                "Niet van plan te gaan stemmen": 3,
                "Partij Blanco": 2
            },
            "federaal": {
                "N-VA": 21,
                "Open VLD": 10,
                "CD&V": 20,
                "Vooruit": 22,
                "Groen": 51,
                "PVDA": 8,
                "Blanco": 2,
                "Niet van plan te gaan stemmen": 3,
                "Partij Blanco": 2
            },
            "europees": {
                "N-VA": 18,
                "Vlaams Belang": 1,
                "Open VLD": 8,
                "CD&V": 18,
                "Vooruit": 18,
                "Groen": 62,
                "PVDA": 7,
                "Blanco": 3,
                "Niet van plan te gaan stemmen": 2,
                "Partij Blanco": 1,
                "Volt": 4
            }
        }
    }

    const personeelData = {
        "personeel": {
            "naam": "Personeel",
            "vlaams": {
                "N-VA": 49,
                "Vlaams Belang": 13,
                "Open VLD": 24,
                "CD&V": 49,
                "Vooruit": 72,
                "Groen": 163,
                "PVDA": 32,
                "Blanco": 2,
                "Niet van plan te gaan stemmen": 7,
                "Partij Blanco": 7,
                "Voor U": 2
            },
            "federaal": {
                "N-VA": 51,
                "Vlaams Belang": 7,
                "Open VLD": 30,
                "CD&V": 43,
                "Vooruit": 79,
                "Groen": 159,
                "PVDA": 31,
                "Blanco": 3,
                "Niet van plan te gaan stemmen": 6,
                "Partij Blanco": 7,
                "L'Unie": 2
            },
            "europees": {
                "N-VA": 41,
                "Vlaams Belang": 6,
                "Open VLD": 28,
                "CD&V": 40,
                "Vooruit": 60,
                "Groen": 190,
                "PVDA": 22,
                "Blanco": 6,
                "Niet van plan te gaan stemmen": 5,
                "Partij Blanco": 3,
                "Volt": 24
            }
        }
    }

    function verwerk(data, parlement, metVorigePeilingen, faculteit, weeg) {
        let perFaculteit = new Map();
        let perPartij = new Map();


        function verwerkStukje(fac, parlement) {
            let resultatenVoorDitParlement = fac[parlement];

            for (let stemkeuze in resultatenVoorDitParlement) {
                if (stemkeuze == "Ik weet het nog niet") {
                    continue;
                }

                const ongewogen = resultatenVoorDitParlement[stemkeuze];
                const gewogen = weeg ? ongewogen * facWegingen.get(fac.naam) : ongewogen;

                if (perFaculteit.has(stemkeuze)) {
                    perFaculteit.set(stemkeuze, perFaculteit.get(stemkeuze) + gewogen)
                } else {
                    perFaculteit.set(stemkeuze, gewogen)
                }

                if (perPartij.has(stemkeuze)) {
                    perPartij.get(stemkeuze).set(fac.naam, gewogen)
                } else {
                    perPartij.set(stemkeuze, new Map([[fac.naam, gewogen]]))
                }
            }
        }

        if (faculteit == undefined) {
            for (let facId in data) {
                let fac = data[facId];
                verwerkStukje(fac, parlement)
            }
        } else {
            verwerkStukje(data[faculteit], parlement)
        }

        let respons = 0
        perPartij.forEach((res, partij) => {
            respons += Math.round([...res.values()].reduce((c, p) => c + p))
        })

        return {
            respons: respons,
            totaal: Array.from([...perFaculteit.entries()].flatMap(el => {
                let vroegere = vroegereResultaten(parlement, el[0]);

                if (vroegere != undefined && metVorigePeilingen) {
                    return [
                        {
                            "partij": el[0],
                            "procentTekst": `${Math.round(vroegere * 1000) / 10} %`,
                            "rel": vroegere,
                            "totaal": el[1],
                            "verdelingPerFac": perPartij.get(el[0]),
                            "tijdsframe": "vroeger",
                            "tijdsframeVolgorde": 1
                        },
                        {
                            "partij": el[0],
                            "procentTekst": `${Math.round(el[1] / respons * 1000) / 10} %`,
                            "rel": el[1] / respons,
                            "totaal": el[1],
                            "verdelingPerFac": perPartij.get(el[0]),
                            "tijdsframe": "nu",
                            "tijdsframeVolgorde": 2
                        }
                    ]
                } else {
                    return [{
                        "partij": el[0],
                        "procentTekst": `${Math.round(el[1] / respons * 1000) / 10} %`,
                        "rel": el[1] / respons,
                        "totaal": el[1],
                        "verdelingPerFac": perPartij.get(el[0]),
                        "tijdsframe": "nu",
                        "tijdsframeVolgorde": 2
                    }]
                }
            })),
        }
    }

    function partijKleuren(naam) {
        switch (naam) {
            case "CD&V": return "#ff6000";
            case "Groen": return "#02ad5b";
            case "PVDA": return "#ef4135";
            case "Partij Blanco": return "#b32d00";
            case "Open VLD": return "#29347e";
            case "N-VA": return "#fabe19";
            case "Vlaams Belang": return "#ffcc00";
            case "Vooruit": return "#cb1a01";
            case "Voor U": return "#df0cb9";
            case "Volt": return "#502379";
            default: return "#8f8f8f";
        }
    }

    function lichtePartijKleuren(naam) {
        switch (naam) {
            case "CD&V": return "#f2a474";
            case "Groen": return "#8bccad";
            case "PVDA": return "#de8f8a";
            case "Partij Blanco": return "#a36c5a";
            case "Open VLD": return "#606794";
            case "N-VA": return "#ffe7a6";
            case "Vlaams Belang": return "#dbc87b";
            case "Vooruit": return "#c97569";
            case "Volt": return "#785c91";
            default: return "#c3c3c3";
        }
    }

    function isPartij(naam) {
        switch (naam) {
            case "CD&V": return true;
            case "Groen": return true;
            case "PVDA": return true;
            case "Partij Blanco": return true;
            case "Open VLD": return true;
            case "N-VA": return true;
            case "Vlaams Belang": return true;
            case "Vooruit": return true;
            case "Voor U": return true;
            case "Volt": return true;
            default: return false;
        }
    }

    function vroegereResultaten(parlement, naam) {
        if (parlement == "vlaams") {
            switch (naam) {
                case "CD&V": return 0.137;
                case "Groen": return 0.295;
                case "PVDA": return 0.034;
                case "Open VLD": return 0.158;
                case "N-VA": return 0.238;
                case "Vlaams Belang": return 0.059;
                case "Vooruit": return 0.052;
                case "Ik stem blanco": return 0.019;
                default: return undefined;
            }
        }

        if (parlement == "federaal") {
            switch (naam) {
                case "CD&V": return 0.14;
                case "Groen": return 0.286;
                case "PVDA": return 0.032;
                case "Open VLD": return 0.190;
                case "N-VA": return 0.223;
                case "Vlaams Belang": return 0.064;
                case "Vooruit": return 0.038;
                case "Ik stem blanco": return 0.015;
                default: return undefined;
            }
        }

        if (parlement == "europees") {
            switch (naam) {
                case "CD&V": return 0.118;
                case "Groen": return 0.302;
                case "PVDA": return 0.023;
                case "Open VLD": return 0.208;
                case "N-VA": return 0.191;
                case "Vlaams Belang": return 0.06;
                case "Vooruit": return 0.044;
                case "Ik stem blanco": return 0.031;
                default: return undefined;
            }
        }
    }

    function partijLogos(naam) {
        switch (naam) {
            case "CD&V": return "https://www.cdenvwevelgem.be/sites/cdvwevelgem/files/styles/colorbox_large__1200x1200/public/t_is_beslist_1080x1080_3_0.png?itok=VwiNS9Qw";
            case "Groen": return "https://assets.nationbuilder.com/groen/pages/15646/attachments/original/1661256240/Logo_fullcolor.png?1661256240";
            case "PVDA": return "https://www.pvdashop.be/cdn/shop/files/PVDA-logo-LARGE-rgb-1_300x300.png?v=1638700063";
            case "Partij Blanco": return "https://blanco2024.be/wp-content/uploads/2023/04/logo-blanco-11-04-2023.png";
            case "Open VLD": return "https://assets.nationbuilder.com/openvld/pages/68/attachments/original/1698034850/logonieuw-light-logo.png?1698034850";
            case "N-VA": return "https://english.n-va.be/sites/international.n-va.be/files/generated/files/page-attachment/logo_nva_verandering-werkt_z_0.jpg";
            case "Vlaams Belang": return "https://www.vlaamsbelangwinkel.org/cdn/shop/files/LOGO_420x200_f1922b23-85a4-4931-927b-6ca468421e2f_600x.png?v=1630921475";
            case "Vooruit": return "https://assets.nationbuilder.com/vooruit/sites/3/meta_images/original/Vooruit_thumbnail.jpg?1619535283";
            case "Voor U": return "https://static.wixstatic.com/media/82fb7d_0931497fc86c4e03897061307239f0fd~mv2.jpg/v1/fit/w_2500,h_1330,al_c/82fb7d_0931497fc86c4e03897061307239f0fd~mv2.jpg";
            case "Volt": return "https://assets.volteuropa.org/inline-images/b9J6p4eyfMBU0e36Ricd4iUYE83SKauBlmRtjNmnejuRHABFLE.png"
            default: return false;
        }
    }

    const facWegingen = new Map([
        ["Faculteit Theologie en Religiewetenschappen", 2.33],
        ["Bijzondere Faculteit Kerkelijk Recht", 1.56],
        ["Hoger Instituut voor Wijsbegeerte", 1.71],
        ["Faculteit Rechtsgeleerdheid en Criminologische Wetenschappen", 0.42],
        ["Faculteit Economie en Bedrijfswetenschappen", 5.06],
        ["Faculteit Sociale Wetenschappen", 1.04],
        ["Faculteit Letteren", 0.3],
        ["Faculteit Psychologische en Pedagogische Wetenschappen", 2.12],
        ["Faculteit Wetenschappen", 0.38],
        ["Faculteit Bio-ingenieurswetenschappen", 1.89],
        ["Faculteit Ingenieurswetenschappen", 0.73],
        ["Faculteit Industriële Ingenieurswetenschappen", 5.42],
        ["Faculteit Architectuur", 6.81],
        ["Faculteit Geneeskunde", 2.75],
        ["Faculteit Farmaceutische Wetenschappen", 3.61],
        ["Faculteit Bewegings- en Revalidatiewetenschappen", 2.23],
    ])

    const facAfkortingen = new Map([
        ["Faculteit Theologie en Religiewetenschappen", "Theo."],
        ["Bijzondere Faculteit Kerkelijk Recht", "Ker. Recht"],
        ["Hoger Instituut voor Wijsbegeerte", "HIW"],
        ["Faculteit Rechtsgeleerdheid en Criminologische Wetenschappen", "Recht."],
        ["Faculteit Economie en Bedrijfswetenschappen", "Econ."],
        ["Faculteit Sociale Wetenschappen", "Soc. Wet."],
        ["Faculteit Letteren", "Lett."],
        ["Faculteit Psychologische en Pedagogische Wetenschappen", "PPW"],
        ["Faculteit Wetenschappen", "Wet."],
        ["Faculteit Ingenieurswetenschappen", "Ing."],
        ["Faculteit Bio-ingenieurswetenschappen", "Bio-ing."],
        ["Faculteit Industriële Ingenieurswetenschappen", "IIW"],
        ["Faculteit Architectuur", "Arch."],
        ["Faculteit Geneeskunde", "Geneesk."],
        ["Faculteit Farmaceutische Wetenschappen", "Farma."],
        ["Faculteit Bewegings- en Revalidatiewetenschappen", "BRW"],
    ])

    const facContent = new Map([
        ["theologie", "<p>Kaas enzo</p>"],
        ["kerkelijk-recht", "<p>hier is tekst</p><p>hier is <i>schuine teskst</i></p>"],
    ])

    function hertekenPerFac(metVorigePeilingen) {
        let teBeschouwenFaculteit = document.getElementById("faculteitSelect").value;
        let data = verwerk(studentenData, "vlaams", metVorigePeilingen, teBeschouwenFaculteit, true)

        const facPlot = Plot.plot({
            title: `Stemgedrag studenten - ${studentenData[teBeschouwenFaculteit].naam}`,
            subtitle: `responsgraad n = ${data.respons}\n${data.respons < 30 ? "(NB: de respons voor deze faculteit ligt erg laag. Neem de resultaten dus met een korrel zout.)" : ""}`,
            marginBottom: 100,
            x: { axis: null },
            fx: { axis: "bottom", tickRotate: -30, label: "Stemkeuze" },
            y: { grid: true, label: null, percent: true },

            style: {
                "min-width": "100%"
            },
            marks: [
                Plot.barY(data.totaal, {

                    channels: {
                        tijdsframeVolgorde: "tijdsframeVolgorde"
                    },

                    x: "tijdsframe",
                    y: "rel",
                    fx: "partij",
                    sort: { x: "tijdsframeVolgorde", fx: "-y", reduce: (group) => group[group.length - 1] },

                    // fill: (obj) => (obj.tijdsframe == "nu" ? partijKleuren(obj.partij) : verlicht(partijKleuren(obj.partij))),
                    fill: (obj) => { if (obj.tijdsframe == "vroeger") { return lichtePartijKleuren(obj.partij) } return partijKleuren(obj.partij) }
                }),
                Plot.image(data.totaal, {
                    fx: "partij",
                    y: (d) => 0.03,
                    filter: (d) => isPartij(d.partij),
                    src: (d) => partijLogos(d.partij),
                    opacity: metVorigePeilingen ? 0.75 : 1,
                    width: 30,
                }),
                Plot.text(data.totaal, {
                    fontFamily: "Tiempos Text",
                    x: "tijdsframe",
                    y: "rel",
                    fx: "partij",
                    text: "procentTekst",
                    lineWidth: 30,
                    textAnchor: "center",
                    stroke: "white",
                    dy: -8,
                    fill: (obj) => obj.tijdsframe == "vroeger" ? "#808080" : "#000000",
                    fontSize: (obj) => obj.tijdsframe == "vroeger" ? 11 : 14,
                })
            ]
        });
        const div = document.querySelector("#faculteit-vlaams");

        if (div !== null) {
            div.innerHTML = "";
            div.append(facPlot);

            const content = document.querySelector("#faculteit-content");
            content.innerHTML = facContent.get(document.getElementById("faculteitSelect").value);
        }

    }

    document.getElementById("faculteitSelect").addEventListener("change", () => { hertekenPerFac(false) });
    // document.getElementById("toon-vorige-peilingen").addEventListener("change", hertekenStudentenPlots)
    document.getElementById("toon").addEventListener("click", () => { hertekenStudentenPlots(true) })
    document.getElementById("verberg").addEventListener("click", () => { hertekenStudentenPlots(false) })

    function renderStudentenPlot(parlement, metVorigePeilingen) {
        const data = verwerk(studentenData, parlement, metVorigePeilingen, undefined, true);

        const plot = Plot.plot({
            title: `Stemgedrag studenten - ${parlement.charAt(0).toUpperCase() + parlement.slice(1)} parlement`,
            subtitle: `responsgraad n = ${data.respons}`,
            marginBottom: 100,
            x: { axis: null },
            fx: { axis: "bottom", tickRotate: -30, label: "Stemkeuze" },
            y: { grid: true, label: null, percent: true },

            style: {
                "min-width": "100%"
            },
            marks: [
                Plot.barY(data.totaal, {

                    channels: {
                        tijdsframeVolgorde: "tijdsframeVolgorde"
                    },

                    x: "tijdsframe",
                    y: "rel",
                    fx: "partij",
                    sort: { x: "tijdsframeVolgorde", fx: "-y", reduce: (group) => group[group.length - 1] },

                    // fill: (obj) => (obj.tijdsframe == "nu" ? partijKleuren(obj.partij) : verlicht(partijKleuren(obj.partij))),
                    fill: (obj) => { if (obj.tijdsframe == "vroeger") { return lichtePartijKleuren(obj.partij) } return partijKleuren(obj.partij) }
                }),
                Plot.image(data.totaal, {
                    fx: "partij",
                    y: (d) => 0.03,
                    filter: (d) => isPartij(d.partij),
                    src: (d) => partijLogos(d.partij),
                    opacity: metVorigePeilingen ? 0.75 : 1,
                    width: 30,
                }),
                Plot.text(data.totaal, {
                    fontFamily: "Tiempos Text",
                    x: "tijdsframe",
                    y: "rel",
                    fx: "partij",
                    text: "procentTekst",
                    lineWidth: 30,
                    textAnchor: "center",
                    stroke: "white",
                    dy: -8,
                    fill: (obj) => obj.tijdsframe == "vroeger" ? "#808080" : "#000000",
                    fontSize: (obj) => obj.tijdsframe == "vroeger" ? 11 : 14,
                }),
                Plot.tip(data.totaal, Plot.pointerX({
                    x: "tijdsframe",
                    y: "rel",
                    fx: "partij",
                    fillOpacity: 0.9,
                    // anchor: "bottom",
                    title: (d) =>
                        d.tijdsframe == "nu" ?
                            d.partij +
                            `\nTotaal: ${Math.round(d.totaal)}\n\n` +
                            [...d.verdelingPerFac.entries()]
                                .toSorted((a, b) => b[1] - a[1])
                                .map((curr) => `${facAfkortingen.get(curr[0])}: ${Math.round(curr[1])} (${(curr[1] / d.totaal * 100).toFixed(1)}%)`)
                                .join("\n")
                            : d.partij + `\nVetopeiling 2019: ${d.procentTekst}`
                }))
            ]
        });
        const div = document.querySelector(`#studenten-${parlement}`);

        if (div !== null) {
            div.innerHTML = "";
            div.append(plot);
        }
    }

    function hertekenStudentenPlots(metVorigePeilingen) {
        renderStudentenPlot("vlaams", metVorigePeilingen);
        renderStudentenPlot("federaal", metVorigePeilingen);
        renderStudentenPlot("europees", metVorigePeilingen);
    }

    function tekenProffenPlot(parlement) {
        let data = verwerk(proffenData, parlement, false, "proffen", false)

        const proffenPlot = Plot.plot({
            title: `Stemgedrag ZAP - ${parlement.charAt(0).toUpperCase() + parlement.slice(1)} parlement`,
            subtitle: `responsgraad n = ${data.respons}\n${data.respons < 30 ? "(NB: de respons voor deze faculteit ligt erg laag. Neem de resultaten dus met een korrel zout.)" : ""}`,
            marginBottom: 100,
            x: { axis: null },
            fx: { axis: "bottom", tickRotate: -30, label: "Stemkeuze" },
            y: { grid: true, label: null, percent: true },

            style: {
                "min-width": "100%"
            },
            marks: [
                Plot.barY(data.totaal, {

                    channels: {
                        tijdsframeVolgorde: "tijdsframeVolgorde"
                    },

                    x: "tijdsframe",
                    y: "rel",
                    fx: "partij",
                    sort: { x: "tijdsframeVolgorde", fx: "-y", reduce: (group) => group[group.length - 1] },

                    // fill: (obj) => (obj.tijdsframe == "nu" ? partijKleuren(obj.partij) : verlicht(partijKleuren(obj.partij))),
                    fill: (obj) => { if (obj.tijdsframe == "vroeger") { return lichtePartijKleuren(obj.partij) } return partijKleuren(obj.partij) }
                }),
                Plot.image(data.totaal, {
                    fx: "partij",
                    y: (d) => 0.03,
                    filter: (d) => isPartij(d.partij),
                    src: (d) => partijLogos(d.partij),
                    width: 30,
                }),
                Plot.text(data.totaal, {
                    fontFamily: "Tiempos Text",
                    x: "tijdsframe",
                    y: "rel",
                    fx: "partij",
                    text: "procentTekst",
                    lineWidth: 30,
                    textAnchor: "center",
                    stroke: "white",
                    dy: -8,
                    fill: (obj) => obj.tijdsframe == "vroeger" ? "#808080" : "#000000",
                    fontSize: (obj) => obj.tijdsframe == "vroeger" ? 11 : 14,
                })
            ]
        });
        const div = document.querySelector(`#proffen-${parlement}`);

        if (div !== null) {
            div.innerHTML = "";
            div.append(proffenPlot);
        }
    }

    function tekenPersoneelPlot(parlement) {
        let data = verwerk(personeelData, parlement, false, "personeel", false)

        const personeelPlot = Plot.plot({
            title: `Stemgedrag personeel - ${parlement.charAt(0).toUpperCase() + parlement.slice(1)} parlement`,
            subtitle: `responsgraad n = ${data.respons}\n${data.respons < 30 ? "(NB: de respons voor deze faculteit ligt erg laag. Neem de resultaten dus met een korrel zout.)" : ""}`,
            marginBottom: 100,
            x: { axis: null },
            fx: { axis: "bottom", tickRotate: -30, label: "Stemkeuze" },
            y: { grid: true, label: null, percent: true },

            style: {
                "min-width": "100%"
            },
            marks: [
                Plot.barY(data.totaal, {

                    channels: {
                        tijdsframeVolgorde: "tijdsframeVolgorde"
                    },

                    x: "tijdsframe",
                    y: "rel",
                    fx: "partij",
                    sort: { x: "tijdsframeVolgorde", fx: "-y", reduce: (group) => group[group.length - 1] },

                    // fill: (obj) => (obj.tijdsframe == "nu" ? partijKleuren(obj.partij) : verlicht(partijKleuren(obj.partij))),
                    fill: (obj) => { if (obj.tijdsframe == "vroeger") { return lichtePartijKleuren(obj.partij) } return partijKleuren(obj.partij) }
                }),
                Plot.image(data.totaal, {
                    fx: "partij",
                    y: (d) => 0.03,
                    filter: (d) => isPartij(d.partij),
                    src: (d) => partijLogos(d.partij),
                    width: 30,
                }),
                Plot.text(data.totaal, {
                    fontFamily: "Tiempos Text",
                    x: "tijdsframe",
                    y: "rel",
                    fx: "partij",
                    text: "procentTekst",
                    lineWidth: 30,
                    textAnchor: "center",
                    stroke: "white",
                    dy: -8,
                    fill: (obj) => obj.tijdsframe == "vroeger" ? "#808080" : "#000000",
                    fontSize: (obj) => obj.tijdsframe == "vroeger" ? 11 : 14,
                })
            ]
        });
        const div = document.querySelector(`#personeel-${parlement}`);

        if (div !== null) {
            div.innerHTML = "";
            div.append(personeelPlot);
        }
    }

    tekenProffenPlot("vlaams");
    tekenProffenPlot("federaal");
    tekenProffenPlot("europees");

    tekenPersoneelPlot("vlaams");
    tekenPersoneelPlot("federaal");
    tekenPersoneelPlot("europees");

    hertekenStudentenPlots(true)
</script>

<button id="toon">Toon vorige Vetopeiling</button>
<button id="verberg">Verberg vorige Vetopeiling</button>

<div id="studenten-vlaams" style="min-width: 100%;"></div>
<div id="studenten-federaal" style="min-width: 100%;"></div>
<div id="studenten-europees" style="min-width: 100%;"></div>

<div id="proffen-vlaams" style="min-width: 100%;"></div>
<div id="proffen-federaal" style="min-width: 100%;"></div>
<div id="proffen-europees" style="min-width: 100%;"></div>

<div id="personeel-vlaams" style="min-width: 100%;"></div>
<div id="personeel-federaal" style="min-width: 100%;"></div>
<div id="personeel-europees" style="min-width: 100%;"></div>

<div id="faculteitengedoe">
    <label for="faculteitSelect">Toon de gegevens per faculteit:</label>
    <select id="faculteitSelect">
        <option value="theologie">Faculteit Theologie en Religiewetenschappen</option>
        <option value="kerkelijk-recht">Bijzondere Faculteit Kerkelijk Recht</option>
        <option value="hiw">Hoger Instituut voor Wijsbegeerte</option>
        <option value="rechten-crimin">Faculteit Rechtsgeleerdheid en Criminologische Wetenschappen</option>
        <option value="econ">Faculteit Economie en Bedrijfswetenschappen</option>
        <option value="soc">Faculteit Sociale Wetenschappen</option>
        <option value="letteren">Faculteit Letteren</option>
        <option value="ppw">Faculteit Psychologische en Pedagogische Wetenschappen</option>
        <option value="wet">Faculteit Wetenschappen</option>
        <option value="ing">Faculteit Ingenieurswetenschappen</option>
        <option value="bio">Faculteit Bio-ingenieurswetenschappen</option>
        <option value="iiw">Faculteit Industriële Ingenieurswetenschappen</option>
        <option value="arch">Faculteit Architectuur</option>
        <option value="geneesk">Faculteit Geneeskunde</option>
        <option value="farma">Faculteit Farmaceutische Wetenschappen</option>
        <option value="brw">Faculteit Bewegings- en Revalidatiewetenschappen</option>
    </select>

    <div id="faculteit-vlaams" style="min-width: 100%;"></div>

    <div id="faculteit-content"></div>
</div>